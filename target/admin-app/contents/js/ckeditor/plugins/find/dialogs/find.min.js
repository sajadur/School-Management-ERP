(function(){function g(h){return h.type==CKEDITOR.NODE_TEXT&&0<h.getLength()&&(!e||!h.isReadOnly())}function c(h){return !(h.type==CKEDITOR.NODE_ELEMENT&&h.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}function f(u,m){function k(n,l){var p=this,q=new CKEDITOR.dom.walker(n);q.guard=l?c:function(t){!c(t)&&(p._.matchBoundary=!0)};q.evaluator=g;q.breakOnFalse=1;n.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=n.startContainer,this.offset=n.startOffset-1);this._={matchWord:l,walker:q,matchBoundary:!1}}function j(n,l){var p=u.createRange();p.setStart(n.textNode,l?n.offset:n.offset+1);p.setEndAt(u.editable(),CKEDITOR.POSITION_BEFORE_END);return p}function i(n){var l=u.getSelection(),p=u.editable();l&&!n?(n=l.getRanges()[0].clone(),n.collapse(!0)):(n=u.createRange(),n.setStartAt(p,CKEDITOR.POSITION_AFTER_START));n.setEndAt(p,CKEDITOR.POSITION_BEFORE_END);return n}var A=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},u.config.find_highlight,!0));k.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(n){var l=this.textNode;if(null===l){return b.call(this)}this._.matchBoundary=!1;if(l&&n&&0<this.offset){this.offset--}else{if(l&&this.offset<l.getLength()-1){this.offset++}else{for(l=null;!l&&!(l=this._.walker[n?"previous":"next"].call(this._.walker),this._.matchWord&&!l||this._.walker._.end);){}this.offset=(this.textNode=l)?n?l.getLength()-1:0:0}}return b.call(this)}};var h=function(n,l){this._={walker:n,cursors:[],rangeLength:l,highlightRange:null,isMatched:0}};h.prototype={toDomRange:function(){var n=u.createRange(),l=this._.cursors;if(1>l.length){var p=this._.walker.textNode;if(p){n.setStartAfter(p)}else{return null}}else{p=l[0],l=l[l.length-1],n.setStart(p.textNode,p.offset),n.setEnd(l.textNode,l.offset+1)}return n},updateFromDomRange:function(n){var l=new k(n);this._.cursors=[];do{n=l.next(),n.character&&this._.cursors.push(n)}while(n.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var n=this.toDomRange(),l=n.createBookmark();A.applyToRange(n,u);n.moveToBookmark(l);this._.highlightRange=n;l=n.startContainer;l.type!=CKEDITOR.NODE_ELEMENT&&(l=l.getParent());l.scrollIntoView();this.updateFromDomRange(n)}},removeHighlight:function(){if(this._.highlightRange){var l=this._.highlightRange.createBookmark();A.removeFromRange(this._.highlightRange,u);this._.highlightRange.moveToBookmark(l);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return !this._.highlightRange?0:this._.highlightRange.startContainer.isReadOnly()},moveBack:function(){var n=this._.walker.back(),l=this._.cursors;n.hitMatchBoundary&&(this._.cursors=l=[]);l.unshift(n);l.length>this._.rangeLength&&l.pop();return n},moveNext:function(){var n=this._.walker.next(),l=this._.cursors;n.hitMatchBoundary&&(this._.cursors=l=[]);l.push(n);l.length>this._.rangeLength&&l.shift();return n},getEndCharacter:function(){var l=this._.cursors;return 1>l.length?null:l[l.length-1].character},getNextCharacterRange:function(n){var l,p;p=this._.cursors;p=(l=p[p.length-1])&&l.textNode?new k(j(l)):this._.walker;return new h(p,n)},getCursors:function(){return this._.cursors}};var y=function(n,l){var p=[-1];l&&(n=n.toLowerCase());for(var q=0;q<n.length;q++){for(p.push(p[q]+1);0<p[q+1]&&n.charAt(q)!=n.charAt(p[q+1]-1);){p[q+1]=p[p[q+1]-1]+1}}this._={overlap:p,state:0,ignoreCase:!!l,pattern:n}};y.prototype={feedCharacter:function(l){for(this._.ignoreCase&&(l=l.toLowerCase());;){if(l==this._.pattern.charAt(this._.state)){return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1}if(this._.state){this._.state=this._.overlap[this._.state]}else{return 0}}return null},reset:function(){this._.state=0}};var s=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,x=function(n){if(!n){return !0}var l=n.charCodeAt(0);return 9<=l&&13>=l||8192<=l&&8202>=l||s.test(n)},r={searchRange:null,matchRange:null,find:function(E,D,C,z,B,l){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(E.length)):this.matchRange=new h(new k(this.searchRange),E.length);for(var t=new y(E,!D),q=0,p="%";null!==p;){for(this.matchRange.moveNext();p=this.matchRange.getEndCharacter();){q=t.feedCharacter(p);if(2==q){break}this.matchRange.moveNext().hitMatchBoundary&&t.reset()}if(2==q){if(C){var v=this.matchRange.getCursors(),n=v[v.length-1],v=v[0],w=u.createRange();w.setStartAt(u.editable(),CKEDITOR.POSITION_AFTER_START);w.setEnd(v.textNode,v.offset);v=w;n=j(n);v.trim();n.trim();v=new k(v,!0);n=new k(n,!0);if(!x(v.back().character)||!x(n.next().character)){continue}}this.matchRange.setMatched();!1!==B&&this.matchRange.highlight();return !0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return z&&!l?(this.searchRange=i(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(n,l,z,v,w,t,q){e=1;n=0;if(this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced&&!this.matchRange.isReadOnly()){this.matchRange.removeHighlight();l=this.matchRange.toDomRange();z=u.document.createText(z);if(!q){var p=u.getSelection();p.selectRanges([l]);u.fire("saveSnapshot")}l.deleteContents();l.insertNode(z);q||(p.selectRanges([l]),u.fire("saveSnapshot"));this.matchRange.updateFromDomRange(l);q||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;n=1}else{n=this.find(l,v,w,t,!q)}e=0;return n}},o=u.lang.find;return{title:o.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton(u,{label:u.lang.common.close})],contents:[{id:"find",label:o.find,title:o.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:o.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:o.find,onClick:function(){var l=this.getDialog();r.find(l.getValueOf("find","txtFindFind"),l.getValueOf("find","txtFindCaseChk"),l.getValueOf("find","txtFindWordChk"),l.getValueOf("find","txtFindCyclic"))||alert(o.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(o.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:o.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:o.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:o.matchCyclic}]}]}]},{id:"replace",label:o.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:o.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:o.replace,onClick:function(){var l=this.getDialog();r.replace(l,l.getValueOf("replace","txtFindReplace"),l.getValueOf("replace","txtReplace"),l.getValueOf("replace","txtReplaceCaseChk"),l.getValueOf("replace","txtReplaceWordChk"),l.getValueOf("replace","txtReplaceCyclic"))||alert(o.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:o.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:o.replaceAll,isChanged:!1,onClick:function(){var l=this.getDialog();r.replaceCounter=0;r.searchRange=i(1);r.matchRange&&(r.matchRange.removeHighlight(),r.matchRange=null);for(u.fire("saveSnapshot");r.replace(l,l.getValueOf("replace","txtFindReplace"),l.getValueOf("replace","txtReplace"),l.getValueOf("replace","txtReplaceCaseChk"),l.getValueOf("replace","txtReplaceWordChk"),!1,!0);){}r.replaceCounter?(alert(o.replaceSuccessMsg.replace(/%1/,r.replaceCounter)),u.fire("saveSnapshot")):alert(o.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(o.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:o.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:o.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:o.matchCyclic}]}]}]}],onLoad:function(){var n=this,l,p=0;this.on("hide",function(){p=0});this.on("show",function(){p=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(q){return function(C){q.call(n,C);var B=n._.tabs[C],w;w="find"===C?"txtFindWordChk":"txtReplaceWordChk";l=n.getContentElement(C,"find"===C?"txtFindFind":"txtFindReplace");n.getContentElement(C,w);B.initialized||(CKEDITOR.document.getById(l._.inputId),B.initialized=!0);if(p){var v,C="find"===C?1:0,B=1-C,t,z=d.length;for(t=0;t<z;t++){w=this.getContentElement(a[C],d[t][C]),v=this.getContentElement(a[B],d[t][B]),v.setValue(w.getValue())}}}})},onShow:function(){r.searchRange=i();var n=this.getParentEditor().getSelection().getSelectedText(),l=this.getContentElement(m,"find"==m?"txtFindFind":"txtFindReplace");l.setValue(n);l.select();this.selectPage(m);this[("find"==m&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var l;r.matchRange&&r.matchRange.isMatched()&&(r.matchRange.removeHighlight(),u.focus(),(l=r.matchRange.toDomRange())&&u.getSelection().selectRanges([l]));delete r.matchRange},onFocus:function(){return"replace"==m?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}}var e,b=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},a=["find","replace"],d=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]];CKEDITOR.dialog.add("find",function(h){return f(h,"find")});CKEDITOR.dialog.add("replace",function(h){return f(h,"replace")})})();